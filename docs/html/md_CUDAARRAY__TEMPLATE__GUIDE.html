<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: CudaArray3D Template Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">CudaArray3D Template Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>Your <code>CudaArray3D</code> class has been successfully converted to a template-based implementation, similar to your <code>MultiArray</code> class. This allows you to specify different data types when creating CUDA arrays.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
What Changed</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Before (Original)</h2>
<div class="fragment"><div class="line">CudaArray3D array(nx, ny, nz);  <span class="comment">// Always used double</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
After (Templated)</h2>
<div class="fragment"><div class="line">CudaArray3D&lt;double&gt; array(nx, ny, nz);           <span class="comment">// Explicit double</span></div>
<div class="line">CudaArray3D&lt;cuDoubleComplex&gt; array(nx, ny, nz);  <span class="comment">// Complex double</span></div>
<div class="line">CudaArray3D&lt;float&gt; array(nx, ny, nz);            <span class="comment">// Single precision</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Supported Data Types</h1>
<p>The template supports the following data types with explicit instantiations:</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Real Number Types</h2>
<ul>
<li><code>double</code> - Double precision real numbers</li>
<li><code>float</code> - Single precision real numbers</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Complex Number Types</h2>
<ul>
<li><code>cuDoubleComplex</code> - CUDA double precision complex numbers</li>
<li><code>cuFloatComplex</code> - CUDA single precision complex numbers</li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Usage Examples</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
1. Basic Usage with Different Types</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;src/utils/CudaArray.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Double precision array (most common)</span></div>
<div class="line">CudaArray3D&lt;double&gt; psi_real(256, 256, 256);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Complex array for wave functions</span></div>
<div class="line">CudaArray3D&lt;cuDoubleComplex&gt; psi_complex(256, 256, 256);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Single precision for memory savings</span></div>
<div class="line">CudaArray3D&lt;float&gt; temp_array(128, 128, 128);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
2. Working with Complex Numbers</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cuComplex.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create complex array</span></div>
<div class="line">CudaArray3D&lt;cuDoubleComplex&gt; complex_array(nx, ny, nz);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// All existing methods work the same way</span></div>
<div class="line">complex_array.memset(0);  <span class="comment">// Zero initialize</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Copy data</span></div>
<div class="line">cuDoubleComplex* host_data = <span class="keyword">new</span> cuDoubleComplex[nx * ny * nz];</div>
<div class="line"><span class="comment">// ... fill host_data ...</span></div>
<div class="line">complex_array.copyFromHost(host_data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get device pointer for kernels</span></div>
<div class="line">cuDoubleComplex* d_ptr = complex_array.raw();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
3. Backward Compatibility</h2>
<p>For existing code, you can use the convenience alias:</p>
<div class="fragment"><div class="line"><span class="comment">// This still works and defaults to double</span></div>
<div class="line">CudaArray3D_double array(nx, ny, nz);  <span class="comment">// Same as CudaArray3D&lt;double&gt;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
Method Signatures</h1>
<p>All methods now work with the template type <code>T</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>CudaArray3D {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Constructors</span></div>
<div class="line">    CudaArray3D(<span class="keywordtype">size_t</span> nx, <span class="keywordtype">size_t</span> ny, <span class="keywordtype">size_t</span> nz, <span class="keywordtype">bool</span> use_pitched = <span class="keyword">true</span>);</div>
<div class="line">    <span class="keyword">explicit</span> CudaArray3D(<span class="keywordtype">size_t</span> n);  <span class="comment">// 1D array</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Data transfer</span></div>
<div class="line">    <span class="keywordtype">void</span> copyFromHost(<span class="keyword">const</span> T* h_data);</div>
<div class="line">    <span class="keywordtype">void</span> copyToHost(T* h_data) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> copyFromHostAsync(<span class="keyword">const</span> T* h_data, cudaStream_t stream = 0);</div>
<div class="line">    <span class="keywordtype">void</span> copyToHostAsync(T* h_data, cudaStream_t stream = 0) <span class="keyword">const</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Device pointers</span></div>
<div class="line">    T* raw();</div>
<div class="line">    <span class="keyword">const</span> T* raw() <span class="keyword">const</span>;</div>
<div class="line">    T* data();  <span class="comment">// Alias for raw()</span></div>
<div class="line">    <span class="keyword">const</span> T* data() <span class="keyword">const</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Element access</span></div>
<div class="line">    T* getElementPtr(<span class="keywordtype">size_t</span> ix, <span class="keywordtype">size_t</span> iy, <span class="keywordtype">size_t</span> iz);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Memory layout (now uses sizeof(T))</span></div>
<div class="line">    <span class="keywordtype">size_t</span> getPitchElements() <span class="keyword">const</span>;  <span class="comment">// Uses sizeof(T)</span></div>
<div class="line">    <span class="keywordtype">size_t</span> getPitchBytes() <span class="keyword">const</span>;     <span class="comment">// Uses sizeof(T)</span></div>
<div class="line">    <span class="keywordtype">size_t</span> getSlicePitch() <span class="keyword">const</span>;     <span class="comment">// Uses sizeof(T)</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// ... other methods unchanged</span></div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md13"></a>
Migration Guide</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
For New Code</h2>
<p>Always use explicit template parameters: </p><div class="fragment"><div class="line">CudaArray3D&lt;double&gt; array(nx, ny, nz);           <span class="comment">// Recommended</span></div>
<div class="line">CudaArray3D&lt;cuDoubleComplex&gt; complex_array(nx, ny, nz);  <span class="comment">// For complex data</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
For Existing Code</h2>
<p>Your existing code should continue to work if you:</p>
<ol type="1">
<li><b>Option 1: Use the alias (minimal changes)</b> <div class="fragment"><div class="line"><span class="comment">// Change this:</span></div>
<div class="line">CudaArray3D array(nx, ny, nz);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// To this:</span></div>
<div class="line">CudaArray3D_double array(nx, ny, nz);</div>
</div><!-- fragment --></li>
<li><b>Option 2: Use explicit templates (recommended)</b> <div class="fragment"><div class="line"><span class="comment">// Change this:</span></div>
<div class="line">CudaArray3D array(nx, ny, nz);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// To this:</span></div>
<div class="line">CudaArray3D&lt;double&gt; array(nx, ny, nz);</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="autotoc_md16"></a>
Integration with Your Project</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
Real3D and Imag3D CUDA Code</h2>
<p>Your existing kernels will work unchanged:</p>
<div class="fragment"><div class="line"><span class="comment">// In your kernel launches</span></div>
<div class="line">CudaArray3D&lt;double&gt; d_psi(nx, ny, nz);</div>
<div class="line">CudaArray3D&lt;cuDoubleComplex&gt; d_psi_complex(nx, ny, nz);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Kernel calls remain the same</span></div>
<div class="line">my_kernel&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(d_psi.raw(), d_psi_complex.raw(), nx, ny, nz);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
cuFFT Integration</h2>
<p>Complex arrays work seamlessly with cuFFT:</p>
<div class="fragment"><div class="line">CudaArray3D&lt;cuDoubleComplex&gt; fft_array(nx, ny, nz);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use with cuFFT</span></div>
<div class="line">cufftExecZ2Z(plan, </div>
<div class="line">    fft_array.raw(),     <span class="comment">// input</span></div>
<div class="line">    fft_array.raw(),     <span class="comment">// output</span></div>
<div class="line">    CUFFT_FORWARD);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Performance Considerations</h1>
<ul>
<li><b>No Performance Impact</b>: Template instantiation happens at compile time</li>
<li><b>Memory Layout</b>: All optimizations (pitched memory, alignment) are preserved</li>
<li><b>Type Safety</b>: Compile-time type checking prevents mixing incompatible types</li>
</ul>
<h1><a class="anchor" id="autotoc_md20"></a>
Compilation Notes</h1>
<ul>
<li>The template is explicitly instantiated for common types in <code>CudaArray.cpp</code></li>
<li>If you need additional types, add them to the explicit instantiation list</li>
<li>CUDA headers (<code>cuComplex.h</code>, <code>cufft.h</code>) are automatically included</li>
</ul>
<h1><a class="anchor" id="autotoc_md21"></a>
Common Patterns</h1>
<h2><a class="anchor" id="autotoc_md22"></a>
Pattern 1: Real and Complex Arrays</h2>
<div class="fragment"><div class="line"><span class="comment">// Real part</span></div>
<div class="line">CudaArray3D&lt;double&gt; psi_real(nx, ny, nz);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Complex representation</span></div>
<div class="line">CudaArray3D&lt;cuDoubleComplex&gt; psi_complex(nx, ny, nz);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert real to complex (in kernel)</span></div>
<div class="line">convert_real_to_complex&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(</div>
<div class="line">    psi_real.raw(), psi_complex.raw(), nx, ny, nz);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
Pattern 2: Mixed Precision</h2>
<div class="fragment"><div class="line"><span class="comment">// High precision computation</span></div>
<div class="line">CudaArray3D&lt;double&gt; precise_array(nx, ny, nz);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Memory-efficient storage</span></div>
<div class="line">CudaArray3D&lt;float&gt; storage_array(nx, ny, nz);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert precision as needed</span></div>
<div class="line">convert_precision&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(</div>
<div class="line">    precise_array.raw(), storage_array.raw(), nx, ny, nz);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md24"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md25"></a>
Compilation Errors</h2>
<ol type="1">
<li><b>Template instantiation errors</b>: Make sure you're using one of the explicitly instantiated types</li>
<li><b>CUDA type errors</b>: Include <code>&lt;cuComplex.h&gt;</code> and <code>&lt;cufft.h&gt;</code> as needed</li>
<li><b>Linking errors</b>: Ensure the explicit instantiations in <code>CudaArray.cpp</code> match your usage</li>
</ol>
<h2><a class="anchor" id="autotoc_md26"></a>
Runtime Issues</h2>
<ol type="1">
<li><b>Size mismatches</b>: Remember that <code>sizeof(T)</code> varies by type</li>
<li><b>Alignment</b>: Complex types have different alignment requirements</li>
<li><b>Memory</b>: Complex types use twice the memory of real types</li>
</ol>
<h1><a class="anchor" id="autotoc_md27"></a>
Summary</h1>
<p>The templated <code>CudaArray3D</code> provides:</p><ul>
<li>✅ Type safety at compile time</li>
<li>✅ Support for multiple data types (double, float, cuDoubleComplex, etc.)</li>
<li>✅ Backward compatibility with existing code</li>
<li>✅ Same performance and memory optimizations</li>
<li>✅ Seamless integration with CUDA and cuFFT</li>
</ul>
<p>Your code can now handle different numerical types efficiently while maintaining the same easy-to-use interface! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
