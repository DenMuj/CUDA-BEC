\doxysection{simpson3d\+\_\+kernel.\+cu}
\hypertarget{simpson3d__kernel_8cu_source}{}\label{simpson3d__kernel_8cu_source}\index{src/utils/simpson3d\_kernel.cu@{src/utils/simpson3d\_kernel.cu}}
\mbox{\hyperlink{simpson3d__kernel_8cu}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00001}00001\ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00009}00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{simpson3d__kernel_8cuh}{simpson3d\_kernel.cuh}}"{}}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <cuda\_runtime.h>}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00011}00011\ \textcolor{preprocessor}{\#include\ <cstdio>}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00024}\mbox{\hyperlink{simpson3d__kernel_8cu_abb2d4be601f829710933376c26dbfc92}{00024}}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{\_\_global\_\_}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{simpson3d__kernel_8cu_abb2d4be601f829710933376c26dbfc92}{simpson3d\_tiled\_reduce}}(\textcolor{keywordtype}{double}\ *\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{f}},\ \textcolor{keywordtype}{double}\ *\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{partial\_sums}},\ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00025}00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cuh_a97700218037a126a9957568d3fe1a8a9}{Nx}},\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cuh_a8202396220c6bb040150929886702185}{Ny}},\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cuh_a51376252920a483727821c5db4ee36ff}{Nz}},}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00026}00026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ tile\_size\_z,\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{z\_start}})\ \{}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00027}00027\ \ \ \textcolor{keyword}{extern}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{\_\_shared\_\_}}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{shared}}[];}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00028}00028\ \ \ \textcolor{keywordtype}{double}*\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{sum\_data}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{shared}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00029}00029\ \ \ \textcolor{keywordtype}{double}*\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{comp\_data}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{shared}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.x\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.y\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.z;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00030}00030\ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00031}00031\ \ \ \textcolor{comment}{//\ Calculate\ thread\ ID\ within\ block}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00032}00032\ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{threadIdx}}.x\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{threadIdx}}.y\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.x\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{threadIdx}}.z\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.x\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.y;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00033}00033\ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00034}00034\ \ \ \textcolor{comment}{//\ Calculate\ global\ 3D\ indices}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00035}00035\ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idx}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockIdx}}.x\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.x\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{threadIdx}}.x;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00036}00036\ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idy}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockIdx}}.y\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.y\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{threadIdx}}.y;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00037}00037\ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idz\_global}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{z\_start}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockIdx}}.z\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.z\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{threadIdx}}.z;\ \ \textcolor{comment}{//\ Global\ z\ index\ in\ full\ volume}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00038}00038\ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idz\_local}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockIdx}}.z\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.z\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{threadIdx}}.z;\ \ \textcolor{comment}{//\ Local\ z\ index\ within\ tile}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00039}00039\ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00040}00040\ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{local\_sum}}\ =\ 0.0;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00041}00041\ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00042}00042\ \ \ \textcolor{comment}{//\ Check\ bounds\ and\ compute\ weighted\ value}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00043}00043\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idx}}\ <\ \mbox{\hyperlink{imag3d-cuda_8cuh_a97700218037a126a9957568d3fe1a8a9}{Nx}}\ \&\&\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idy}}\ <\ \mbox{\hyperlink{imag3d-cuda_8cuh_a8202396220c6bb040150929886702185}{Ny}}\ \&\&\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idz\_global}}\ <\ \mbox{\hyperlink{imag3d-cuda_8cuh_a51376252920a483727821c5db4ee36ff}{Nz}}\ \&\&\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idz\_local}}\ <\ tile\_size\_z)\ \{}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00044}00044\ \ \ \ \ \textcolor{comment}{//\ Use\ local\ index\ for\ accessing\ the\ tile\ data\ in\ memory}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00045}00045\ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{linear\_idx}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idz\_local}}\ *\ \mbox{\hyperlink{imag3d-cuda_8cuh_a97700218037a126a9957568d3fe1a8a9}{Nx}}\ *\ \mbox{\hyperlink{imag3d-cuda_8cuh_a8202396220c6bb040150929886702185}{Ny}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idy}}\ *\ \mbox{\hyperlink{imag3d-cuda_8cuh_a97700218037a126a9957568d3fe1a8a9}{Nx}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idx}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00046}00046\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00047}00047\ \ \ \ \ \textcolor{comment}{//\ Compute\ Simpson\ weights\ using\ GLOBAL\ indices\ (important\ for\ boundary\ conditions)}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00048}00048\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{weight\_x}}\ =\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idx}}\ ==\ 0\ ||\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idx}}\ ==\ \mbox{\hyperlink{imag3d-cuda_8cuh_a97700218037a126a9957568d3fe1a8a9}{Nx}}\ -\/\ 1)\ ?\ 1.0\ :\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idx}}\ \%\ 2\ ==\ 1)\ ?\ 4.0\ :\ 2.0;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00049}00049\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{weight\_y}}\ =\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idy}}\ ==\ 0\ ||\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idy}}\ ==\ \mbox{\hyperlink{imag3d-cuda_8cuh_a8202396220c6bb040150929886702185}{Ny}}\ -\/\ 1)\ ?\ 1.0\ :\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idy}}\ \%\ 2\ ==\ 1)\ ?\ 4.0\ :\ 2.0;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00050}00050\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{weight\_z}}\ =\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idz\_global}}\ ==\ 0\ ||\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idz\_global}}\ ==\ \mbox{\hyperlink{imag3d-cuda_8cuh_a51376252920a483727821c5db4ee36ff}{Nz}}\ -\/\ 1)\ ?\ 1.0\ :\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{idz\_global}}\ \%\ 2\ ==\ 1)\ ?\ 4.0\ :\ 2.0;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00051}00051\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00052}00052\ \ \ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{local\_sum}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{f}}[\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{linear\_idx}}]\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{weight\_x}}\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{weight\_y}}\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{weight\_z}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00053}00053\ \ \ \}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00054}00054\ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00055}00055\ \ \ \textcolor{comment}{//\ Store\ in\ shared\ memory\ for\ reduction}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00056}00056\ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{sum\_data}}[\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}]\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{local\_sum}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00057}00057\ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{comp\_data}}[\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}]\ =\ 0.0;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00058}00058\ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{\_\_syncthreads}}();}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00059}00059\ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00060}00060\ \ \ \textcolor{comment}{//\ Perform\ tree-\/based\ reduction\ in\ shared\ memory}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00061}00061\ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{block\_size}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.x\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.y\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockDim}}.z;}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00062}00062\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{s}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{block\_size}}\ /\ 2;\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{s}}\ >\ 0;\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{s}}\ >>=\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00063}00063\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}\ <\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{s}}\ \&\&\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{s}}\ <\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{block\_size}})\ \{}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00064}00064\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_a}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{sum\_data}}[\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}]\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{comp\_data}}[\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}];}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00065}00065\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_b}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{sum\_data}}[\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{s}}]\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{comp\_data}}[\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{s}}];}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00066}00066\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{temp}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_a}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_b}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00067}00067\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{corr}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00068}00068\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{fabs}}(\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_a}})\ >=\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{fabs}}(\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_b}}))\ \{}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00069}00069\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{corr}}\ =\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_a}}\ -\/\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{temp}})\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_b}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00070}00070\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00071}00071\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{corr}}\ =\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_b}}\ -\/\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{temp}})\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{val\_a}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00072}00072\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00073}00073\ \ \ \ \ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{sum\_data}}[\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}]\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{temp}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00074}00074\ \ \ \ \ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{comp\_data}}[\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}]\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{corr}};}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00075}00075\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00076}00076\ \ \ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{\_\_syncthreads}}();}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00077}00077\ \ \ \}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00078}00078\ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00079}00079\ \ \ \textcolor{comment}{//\ Thread\ 0\ adds\ the\ block's\ sum\ to\ global\ result}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00080}00080\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{tid}}\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00081}00081\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{block\_sum}}\ =\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{sum\_data}}[0]\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{comp\_data}}[0];}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00082}00082\ \ \ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{atomicAdd}}(\&\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{partial\_sums}}[0],\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{block\_sum}});}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00083}00083\ \ \ \}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00084}00084\ \}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00097}\mbox{\hyperlink{simpson3d__kernel_8cu_a99f63c72c09355d8a595f34f0a9fc34e}{00097}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{simpson3d__kernel_8cu_a99f63c72c09355d8a595f34f0a9fc34e}{launchSimpson3DKernel}}(\textcolor{keywordtype}{double}*\ d\_f,\ \textcolor{keywordtype}{double}*\ d\_partial\_sum,}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cuh_a97700218037a126a9957568d3fe1a8a9}{Nx}},\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cuh_a8202396220c6bb040150929886702185}{Ny}},\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cuh_a51376252920a483727821c5db4ee36ff}{Nz}},}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ tile\_size\_z,\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{z\_start}},}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{current\_tile\_z}})\ \{}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00101}00101\ \ \ \ \ \textcolor{comment}{//\ Configure\ kernel\ launch\ parameters}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00102}00102\ \ \ \ \ dim3\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}(8,\ 8,\ 4);\ \ \textcolor{comment}{//\ 8*8*4\ =\ 256\ threads\ per\ block}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00103}00103\ \ \ \ \ dim3\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{gridSize}}((\mbox{\hyperlink{imag3d-cuda_8cuh_a97700218037a126a9957568d3fe1a8a9}{Nx}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}.x\ -\/\ 1)\ /\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}.x,}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{imag3d-cuda_8cuh_a8202396220c6bb040150929886702185}{Ny}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}.y\ -\/\ 1)\ /\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}.y,}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{current\_tile\_z}}\ +\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}.z\ -\/\ 1)\ /\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}.z);}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00106}00106\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00107}00107\ \ \ \ \ \textcolor{comment}{//\ Calculate\ shared\ memory\ size\ for\ reduction}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00108}00108\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{shared\_mem\_size}}\ =\ 2\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}.x\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}.y\ *\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{blockSize}}.z\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{double}});}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00109}00109\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00110}00110\ \ \ \ \ \textcolor{comment}{//\ Launch\ kernel}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00111}00111\ \ \ \ \ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{simpson3d\_tiled\_reduce<<<gridSize,\ blockSize,\ shared\_mem\_size>}}>>(}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00112}00112\ \ \ \ \ \ \ \ \ d\_f,\ d\_partial\_sum,\ \mbox{\hyperlink{imag3d-cuda_8cuh_a97700218037a126a9957568d3fe1a8a9}{Nx}},\ \mbox{\hyperlink{imag3d-cuda_8cuh_a8202396220c6bb040150929886702185}{Ny}},\ \mbox{\hyperlink{imag3d-cuda_8cuh_a51376252920a483727821c5db4ee36ff}{Nz}},\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{current\_tile\_z}},\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{z\_start}});}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00113}00113\ \}}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00120}\mbox{\hyperlink{simpson3d__kernel_8cu_a021e09a5e642ceda94915c02626f0c92}{00120}}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{simpson3d__kernel_8cu_a021e09a5e642ceda94915c02626f0c92}{getCudaErrorString}}(\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{cudaError\_t}}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{error}})\ \{}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00121}00121\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{cudaGetErrorString}}(\mbox{\hyperlink{imag3d-cuda_8cu_a8e7473dac38d04dd72def94975425b2f}{error}});}
\DoxyCodeLine{\Hypertarget{simpson3d__kernel_8cu_source_l00122}00122\ \}}

\end{DoxyCode}
